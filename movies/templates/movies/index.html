{% extends 'base.html' %}
{% load mathfilters %}
    
{% block body %}    
    <div class="main_section">
        <section class="box_office">
            <h3 class="section_header">일일 박스오피스 {{ date }} 기준</h3>
            <div class="movie_strip swiper-container">
                <div class="swiper-wrapper">

                    <div v-for="movie in allMovies.slice(0, 10)" class="movie_preview swiper-slide" data-toggle="modal" data-target="#exampleModalCenter" @click="setCurrentMovie(movie)">
                        <img :src="movie.posterUrl">
                        <div class="movie_poster_bg"></div>
                        <span class="movie_preview_text movie_title">[[ movie.movieNm ]]</span>
                        <span class="movie_preview_text movie_year">[[ movie.openDt | getYear ]]년</span>
                        <div class="movie_preview_text movie_score">
                            <div class="star-ratings-css">
                                <div class="star-ratings-css-top" :style="{'width': `${movie.score*10}%`}">
                                    <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                <div class="star-ratings-css-bottom">
                                    <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
        <section class="recommendation">
            <h3 class="section_header">영화 추천<a href="{% url 'movies:movie_suggestions' %}"><button class="btn btn-crimson advanced_rec">추천 더보기</button></a></h3>
            
            <div class="movie_strip swiper-container2">
                <div class="swiper-wrapper">
                    <div v-for="movie in allMovies.slice(10, )" class="movie_preview swiper-slide" data-toggle="modal" data-target="#exampleModalCenter" @click="setCurrentMovie(movie)">
                        <img :src="movie.posterUrl">
                        <div class="movie_poster_bg"></div>
                        <span class="movie_preview_text movie_title">[[ movie.movieNm ]]</span>
                        <span class="movie_preview_text movie_year">[[ movie.openDt | getYear ]]년</span>
                        <div class="movie_preview_text movie_score">
                            <div class="star-ratings-css">
                                <div class="star-ratings-css-top" :style="{'width': `${movie.score*10}%`}">
                                    <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                <div class="star-ratings-css-bottom">
                                    <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </section>
        <section class="recent_scores">
            <h3 class="section_header">최신 평점</h3>
            
            <!-- Bootstrap Grid System-->
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-4 col-sm-6 col-12" v-for="review in allScores.reverse().slice(0, 5)">
                        <div class="reviewCard">
                            <div class="reviewStars">
                                <div class="star-ratings-css">
                                    <div class="star-ratings-css-top" :style="{'width': `${review.score*10}%`}">
                                        <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                    <div class="star-ratings-css-bottom">
                                        <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                </div>
                            </div>
                            <div class="reviewContent">
                                [[ review.comment ]]
                            </div>
                            <div class="reviewMovieTitle">
                                - [[ review.movie.movieNm ]]
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>


    <!-- MODAL VUE.JS CURRENT MOVIE-->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-body modal_head">
                    <h3 class="movie_modal_title">[[ currentMovie.movieNm ]] ([[ currentMovie.openDt | getYear ]])</h3>
                    <div class="movie_modal_left">
                        <div class="movie_modal_score">
                            <div class="star-ratings-css">
                                <div class="star-ratings-css-top" :style="{'width': `${currentMovie.score*10}%`}">
                                    <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                <div class="star-ratings-css-bottom">
                                    <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                            </div>
                            [[ currentMovie.score ]]점
                            <button class="btn btn-sm btn-crimson">Add to watchlist</button>
                        </div>
                    </div>
                </div>
                
                <div class="modal-body modal_content">
                    <div class="movie_modal_left">
                        <div class="movie_modal_stills">
                            <div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel">
                              <div class="carousel-inner">
                                <div class="carousel-item" :class="{active: index === 0}" v-for="(item, index) in currentMovie.stillCut">
                                  <img :src="item" class="d-block w-100 h-100">
                                </div>
                              </div>
                              <a class="carousel-control-prev" href="#carouselExampleFade" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                              </a>
                              <a class="carousel-control-next" href="#carouselExampleFade" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                              </a>
                            </div>
                        
                        </div>
                        <div class="movie_modal_trailer">
                            <iframe :src=`https://www.youtube.com/embed/${currentMovie.trailer}` frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                        <div class="movie_modal_text">
                            <div class="movie_modal_text_section">
                                <p>개요</p>
                                <p>[[currentMovie.openDt]] 개봉&nbsp;&nbsp;|&nbsp;&nbsp;<span v-for="nation in currentMovie.nation">[[ nation ]],</span>&nbsp;&nbsp;|&nbsp;&nbsp;[[currentMovie.showTm]]분</p>
                            </div>
                            <div class="movie_modal_text_section">
                                <p>장르</p>
                                <p><span v-for="genre in currentMovie.genre">[[ genre ]] | </span></p>
                            </div>
                            <div class="movie_modal_text_section">
                                <p>누적</p>
                                <p>[[ currentMovie.audiAcc ]]명</p>
                            </div>
                            <div class="movie_modal_text_section">
                                <p>감독</p>
                                <p><span v-for="director in currentMovie.director">[[ director ]],</span></p>
                            </div>
                            <div class="movie_modal_text_section">
                                <p>출연</p>
                                <p><span v-for="actor in currentMovie.actor">[[ actor ]],</span></p>
                            </div>
                            <div class="movie_modal_text_section">
                                <p>줄거리</p>
                                <p>[[currentMovie.description]]</p>
                            </div>
                        </div>
                    </div>
                    <div class="movie_modal_right">
                        <h4>평점</h4>
                        <div class="score_form_outer">
                            <div class="star_rate">
                                <span class="rating">
                                    <input type="radio" class="rating-input"
                                            id="rating-input-1-5" name="rating-input-1" value=10 v-model="rating_score">
                                    <label for="rating-input-1-5" class="rating-star" title="10" @mouseover="scoreHoverOver(10)" @mouseleave="scoreHoverLeave()">★</label>
                                    
                                    <input type="radio" class="rating-input"
                                            id="rating-input-1-4" name="rating-input-1" value=8 v-model="rating_score">
                                    <label for="rating-input-1-4" class="rating-star" title="8" @mouseover="scoreHoverOver(8)" @mouseleave="scoreHoverLeave()">★</label>
                                    
                                    <input type="radio" class="rating-input"
                                            id="rating-input-1-3" name="rating-input-1" value=6 v-model="rating_score">
                                    <label for="rating-input-1-3" class="rating-star" title="6" @mouseover="scoreHoverOver(6)" @mouseleave="scoreHoverLeave()">★</label>
                                    
                                    <input type="radio" class="rating-input"
                                            id="rating-input-1-2" name="rating-input-1" value=4 v-model="rating_score">
                                    <label for="rating-input-1-2" class="rating-star" title="4" @mouseover="scoreHoverOver(4)" @mouseleave="scoreHoverLeave()">★</label>
                                    
                                    <input type="radio" class="rating-input"
                                            id="rating-input-1-1" name="rating-input-1" value=2 v-model="rating_score">
                                    <label for="rating-input-1-1" class="rating-star" title="2" @mouseover="scoreHoverOver(2)" @mouseleave="scoreHoverLeave()">★</label>
                                </span>
                            </div>
                            <div class="score_num">
                                <span v-if="scoreHover">[[ ratingScoreTmp ]]점</span>
                                <span v-else>[[ rating_score ]]점</span>
                            </div>
                            <input type="text" class="score_input" v-model="ratingScoreContent">
                            <button class="btn btn-sm btn-crimson score_btn" @click="createScoreReview()">등록</button>
                        </div>
                        
                        <div class="showReviews">
                            <div class="reviewContainer" v-for="review in currentScores">
                                <div class="reviewStars">
                                    <div class="star-ratings-css">
                                        <div class="star-ratings-css-top" :style="{'width': `${review.score*10}%`}">
                                            <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                        <div class="star-ratings-css-bottom">
                                            <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                    </div>
                                    [[ review.score ]]점
                                </div>
                                <div class="reviewComment">[[ review.comment ]] - [[ review.user.username ]]</div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    
{% endblock %}
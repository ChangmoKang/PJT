<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>KCM의 흑백영화</title>

    <!-- GOOGLE FONTS - NOTO SANS KR -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR" rel="stylesheet">

    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/css/swiper.min.css">
    
    <!-- BOOTSTRAP CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- BOOTSTRAP JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <!-- Swiper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/js/swiper.min.js"></script>
    
    <!-- VUE.JS -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/vue"></script>-->
    
    <!-- LODASH -->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.10/lodash.min.js"></script>

    <!-- AXIOS -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    
    <style>
        * {
            margin: 0; padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        ::-webkit-scrollbar { 
            display: none; 
        }
        
        body {
            min-width: 360px;
            overflow-x: hidden;
        }
        
        #wrap {
            width: 100%;
            position: relative;
            background-color: #A9B7C0;
        }
        
        [v-cloak] {
            display: none;
        }

        .btn-crimson {
            background-color: #328CC1;
            border-color: #28709A;
            color: #F6F6F8;
        }
        .btn-crimson:hover {
            background-color: #28709A;
            border-color: #28709A;
            color: #F6F6F8;
        }
        .btn-outline-crimson {
            border-color: #328CC1;
            color: #328CC1;
        }
        .btn-outline-crimson:hover {
            background-color: #328CC1;
            border-color: #28709A;
            color: #F6F6F8;
        }



        /* * * * * * * * *  SWIPER * * * * * * * * */
        
        .swiper-container, .swiper-container2 {
            width: 100%;
        }


        /* * * * * * * * *  NAVBAR * * * * * * * * */
        nav {
            position: fixed;
            top: 0;
            z-index: 999;
            width: 100%;
            height: 50px;
            line-height: 50px;
            background-color: #A9B7C0;
            color: #F6F6F8;
        }

        .nav_left {
            float: left;
            height: 100%;
        }

        .nav_right {
            float: right;
            height: 100%;
        }

        .nav_item {
            float: left;
            margin: 0 15px;
            color: #181818;
            font-weight: bold;
        }
        .nav_item:hover {
            color: #328CC1;
            text-decoration: none;
            cursor: pointer;
        }

        .nav_home {
            width: 70px;
            height: 100%;
            position: relative;
            color: #181818;
        }
        .nav_home:hover {
            /*color: #181818;*/
            color: #328CC1;
        }
        .nav_home > i {
            position: absolute;
            top: 10px;
            left: 8px;
        }
        .nav_home > span {
            position: absolute;
            font-size: 12px;
            top: 12px;
        }


        /* * * * * * * * *  MAIN SECTION * * * * * * * * */
        .main_section {
            margin-top: 50px;
            width: 100%;
            color: #328CC1;
        }

        section {
            width: 100%;
            height: 430px;
            padding: 10px 0 20px;
            margin-bottom: 5px;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        }

        .section_header {
            width: 100%;
            height: 40px;
            line-height: 40px;
            padding: 0 20px;
            font-weight: bold;
            color: #328CC1;
        }

        .movie_strip {
            width: 100%;
            height: calc(400px - 40px);
        }

        .movie_preview {
            width: 240px;
            height: calc(100% - 20px);
            box-shadow: 1px 1px 10px #181818;
            margin: 0 30px;
            position: relative;
            float: left;
        }

        .movie_preview > img {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .movie_poster_bg {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent 30%);
        }

        .movie_preview_text {
            position: absolute;
            color: #F6F6F8;
            z-index: 99;
            text-shadow: 1px 1px 0 #181818;
        }

        .movie_title {
            bottom: 35px;
            font-size: 18px;
            margin-left: 10px;
        }

        .movie_year {
            bottom: 10px;
            right: 10px;
        }

        .movie_score {
            bottom: 17px;
            /* width: 100px; */
            margin-left: 10px;
            font-family: 'Open Sans', sans-serif;
            /* overflow: hidden; */
        }


        /* * * * * * * * *  STAR RATING PERCENTAGE * * * * * * * * */

        @import url(https://fonts.googleapis.com/css?family=Open+Sans:400,600,700);

        .star-ratings-css {
            unicode-bidi: bidi-override;
            color: #E3E3E3;
            font-size: 18px;
            height: 18px;
            width: 90px; 
            position: relative;
            padding: 0;
            text-shadow: 0px 1px 0 #6C6C6C;
        }

        .star-ratings-css-top {
            color: #FA534F;
            padding: 0;
            position: absolute;
            z-index: 1;
            display: block;
            top: 0;
            left: 0;
            overflow: hidden;
        }

        .star-ratings-css-bottom {
            padding: 0;
            display: block;
            z-index: 0;
        }


        .advanced_rec {
            float: right;
        }


        /* * * * * * * * *  MODAL * * * * * * * * */
        .modal-content {
            background-color: #F6F6F8;
            color: #181818;
        }
        .modal_head {
            padding-bottom: 0;
        }
        
        .movie_modal_title {
            letter-spacing: 1px;
        }
        
        .modal-body {
            /*height: 500px;*/
            /*overflow-y: auto;*/
        }
        
        .movie_modal_left {
            width: 50%;
            float: left;
            padding-right: 10px;
            overflow: hidden;
        }
        .movie_modal_right {
            width: 50%;
            float: right;
            padding-left: 10px;
            overflow: hidden;
        }
        
        @media screen and (max-width: 992px) {
            .movie_modal_left, .movie_modal_right {
                width: 100%;
                float: none;
                padding: 0;
            }
            .movie_modal_left {
                padding-bottom: 10px;
            }
            .movie_modal_right {
                padding-top: 30px;
                border-top: 1px solid #E3E3E3;
            }
        }
        
        .movie_modal_score {
            height: 35px;
            line-height: 35px;
            margin-top: 10px;
        }
        .movie_modal_score .star-ratings-css {
            width: 90px;
            float: left;
            margin-right: 5px;
        }
        .movie_modal_score button {
            float: right;
        }
        
        .modal_content {
            height: calc(100vh - 160px);
            overflow-y: auto;
        }
        
        .movie_modal_stills {
            width: 100%;
            height: 200px;
            position: relative;
            overflow: hidden;
        }
        
        .movie_modal_trailer {
            width: 100%;
            height: 200px;
            margin-top: 20px;
        }
        .movie_modal_trailer > iframe {
            width: 100%; height: 100%;
        }
        
        .movie_modal_text {
            margin-top: 20px;
            border-top: 1px solid #E3E3E3;
            padding-top: 20px;
            width: 100%;
        }
        
        .movie_modal_text_section {
            width: 100%;
            color: #181818;
            overflow: hidden;
        }
        .movie_modal_text_section p:first-child {
            width: 55px;
            font-weight: bold;
            color: #328CC1;
            font-size: 16px;
            float: left;
        }
        .movie_modal_text_section p:last-child {
            float: right;
            width: calc(100% - 55px);
            overflow: hidden;
        }


        /* * * * * * * * *  SCORE FORM (MODAL) * * * * * * * * */
        .score_form_outer {
            width: 100%;
            height: 35px;
        }

        .star_rate {
            width: 83px;
            height: 32px;
            float: left;
        }
        .rating {
            overflow: hidden;
            display: inline-block;
        }
        .rating-input {
            float: right;
            margin: 0 0 0 -16px;
            opacity: 0;
        }
        .rating-star {
            cursor: pointer;
            position: relative;
            display: block;
            width: 16px;
            font-size: 16px;
            height: 16px;
            color: #E3E3E3;
            float: right;
        }

        .rating:hover .rating-star:hover, 
        .rating:hover .rating-star:hover ~ .rating-star,
        .rating-input:checked ~ .rating-star {
            color: #FA534F;
        }

        .rating:hover .rating-star {
            color: #E3E3E3;
        }

        .score_input {
            float: left;
            width: calc(100% - 83px - 110px);
            height: 30px;
            margin-left: 10px;
            border: 1px solid #E3E3E3;
            border-radius: 3px;
        }
        .score_input:focus {
            outline-color: #C60021;
        }

        .score_btn {
            float: left;
            margin-left: 10px;
        }
        .score_num {
            float: left;
            width: 30px;
            margin-left: 5px;
            line-height: 27px;
            font-size: 14px;
        }


        /* * * * * * * * *  SHOW SCORES/REVIEW (MODAL) * * * * * * * * */
        .showReviews {
            margin-top: 20px;
        }
        .reviewContainer {
            font-size: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .reviewStars {
            width: 125px;
            display: inline-block;
        }
        .reviewContainer .star-ratings-css {
            font-size: 15px;
            width: 76px;
            display: inline-block;
        }
        .reviewComment {
            width: calc(100% - 125px);
            float: right;
        }
        
        .editdelbtn {
            width: 40px;
            height: 30px; line-height: 30px;
            text-align: center;
            font-size: 12px;
            background: #328CC1;
            border-radius: 5px;
            padding: 0 3px;
            margin: 0 1px;
            color: #F6F6F8;
            cursor: pointer;
        }




        /* * * * * * * * *  RECENT REVIEWS * * * * * * * * */
        
        .recent_scores {
            height: 330px;
            overflow: hidden;
        }
        .reviewCard {
            margin-top: 20px;
            margin-bottom: 50px;
            width: 100%;
            height: 200px;
            border-radius: 10px;
            background-color: #E6E6E6;
            padding: 10px;
            overflow-y: auto;
            color: #181818;
        }
        .reviewMovieTitle {
            margin-top: 10px;
            /*margin-bottom: 10px;*/
        }
        .reviewCard .star-ratings-css {
            display: inline-block;
            margin-left: 10px;
            color: #D2D2D2;
        }
        .reviewContent {
            margin-top: 10px;
            padding: 0 10px;
        }
        .reviewUser {
            color: #6C6C6C;
            font-size: 14px;
            margin-top: 10px;
            padding: 0 10px;
        }
        
        



        /* * * * * * * * *  FOOTER * * * * * * * * */
        footer {
            width: 100%;
            height: 150px;
            background-color: #28709A;
            color: #F6F6F8;
            padding: 20px;
            text-align: center;
        }
        footer p {
            margin: 0;
            font-size: 14px;
        }
        
        
        
        
        
        
        /* * * * * * * * *  SUGGESTIONS PAGE * * * * * * * * */
        
        #suggMainContainer {
            margin-top: 50px;
            width: 100%;
            height: calc(100vh - 100px);
            padding: 20px;
            overflow-y: auto;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        }

        .optionSelectBox {
            margin: 10px auto;
            width: 550px;
            height: 160px;
        }
        .genreSelectMenu {
            width: 400px;
            float: left;
            color: #F6F6F8;
        }
        .genreCheckbox, .nationCheckbox {
            width: 100px;
            height: 40px; line-height: 36px;
            font-weight: bold;
            text-align: center;
            color: #F6F6F8;
            background: linear-gradient(to bottom, #328CC1, #0B3C5D);
            border: 3px outset #328CC1;
            border-radius: 5px;
        }
        .genreCheckbox:hover, .nationCheckbox:hover {
            background: #328CC1;
        }
        #genreCB, #nationCB {
            display: none;
        }
        #genreCB:checked ~ .genreOptions,
        #nationCB:checked ~ .nationOptions {
            display: block;
        }
        .genreOptions, .nationOptions {
            width: 100%;
            display: none;
        }
        .genreOption {
            display: inline-block;
            padding: 2px 10px;
            margin: 2px 3px;
            border-radius: 10px;
            border: 2px solid #328CC1;
            color: #F6F6F8;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }
        .selectedGenre {
            background: linear-gradient(to bottom, #328CC1, #0B3C5D);
            color: #F6F6F8;
        }

        .nationSelectMenu {
            width: 130px;
            margin-left: 20px;
            float: left;
        }
        .nationRadio {
            font-weight: bold;
            color: #328CC1;
            font-size: 14px;
        }

        .suggResults {
            width: 100%;
            height: 300px;
        }
        
        .movieCardCont {
            width: 100%;
            height: 280px;
            position: relative;
            perspective: 500px;
        }
        .movieCard {
            width: 200px;
            height: calc(100% - 20px);
            margin-bottom: 20px;
            position: absolute;
            top: 0; left: 50%;
            transform: translate(-50%);
            transition: all 5s;
            box-shadow: 2px 2px 5px #181818;
        }
        
        .movieCard:hover {
            transform: translate(-50%) rotateY(180deg);
        }
        
        .movieCardPoster {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0; left: 0;
        }
        
        .suggResults .movie_preview_text {
            font-size: 14px;
        }
        
        /* * * * * * * * *  FORMS * * * * * * * * */
        
        .form_section {
            width: 100%;
            height: calc(100vh - 200px);
            overflow-y: auto;
            background-color: #E3E3E3;
        }
        
        .formSection {
            width: 600px;
            margin: 40px auto;
            padding-top: 20px;
        }
        
        
    </style>
</head>

<body>
    <div id="wrap" v-cloak>
        <nav>
            <div class="nav_left">
                <a href="{% url 'movies:movie_index' %}">
                    <div class="nav_item nav_home">
                        <i class="fas fa-video"></i>
                        <span>HOME</span>
                    </div>
                </a>
            </div>
            <div class="nav_right">
                {% if request.user.is_authenticated %}
                    <span class="nav_item" @click="showMode = 'watch'">찜한목록</span>
                    <a href="{% url 'accounts:logout' %}" class="nav_item">로그아웃</a>
                {% else %}
                    <a href="{% url 'accounts:login' %}" class="nav_item">로그인</a>
                    <a href="{% url 'accounts:signup' %}" class="nav_item">회원가입</a>
                {% endif %}
            </div>
        </nav>
        
        {% block body %}
        {% endblock %}
        
        <!-- MODAL VUE.JS CURRENT MOVIE-->
        <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
            aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-body modal_head">
                        <h3 class="movie_modal_title">[[ currentMovie.movieNm ]] ([[ currentMovie.openDt | getYear ]])</h3>
                        <div class="movie_modal_left">
                            <div class="movie_modal_score">
                                <div class="star-ratings-css">
                                    <div class="star-ratings-css-top" :style="{'width': `${currentMovie.score*10}%`}">
                                        <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                    <div class="star-ratings-css-bottom">
                                        <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                </div>
                                [[ currentMovie.score ]]점
                                <button class="btn btn-sm btn-crimson" @click="removeFromWatch(currentMovie.id)" v-if="currentMovieInWatchlist()">찜하기 취소</button>
                                <button class="btn btn-sm btn-crimson" @click="addToWatch(currentMovie.id)" v-else>찜하기</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-body modal_content">
                        <div class="movie_modal_left">
                            <div class="movie_modal_stills">
                                <div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel">
                                  <div class="carousel-inner">
                                    <div class="carousel-item" :class="{active: index === 0}" v-for="(item, index) in currentMovie.stillCut">
                                      <img :src="item" class="d-block w-100 h-100">
                                    </div>
                                  </div>
                                  <a class="carousel-control-prev" href="#carouselExampleFade" role="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                  </a>
                                  <a class="carousel-control-next" href="#carouselExampleFade" role="button" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                  </a>
                                </div>
                            
                            </div>
                            <div class="movie_modal_trailer">
                                <iframe :src=`https://www.youtube.com/embed/${currentMovie.trailer}` frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            <div class="movie_modal_text">
                                <div class="movie_modal_text_section">
                                    <p>개요</p>
                                    <p>[[currentMovie.openDt]] 개봉&nbsp;&nbsp;|&nbsp;&nbsp;<span v-for="nation in currentMovie.nation">[[ nation ]],</span>&nbsp;&nbsp;|&nbsp;&nbsp;[[currentMovie.showTm]]분</p>
                                </div>
                                <div class="movie_modal_text_section">
                                    <p>장르</p>
                                    <p><span v-for="genre in currentMovie.genre">[[ genre ]] | </span></p>
                                </div>
                                <div class="movie_modal_text_section">
                                    <p>누적</p>
                                    <p>[[ currentMovie.audiAcc ]]명</p>
                                </div>
                                <div class="movie_modal_text_section">
                                    <p>감독</p>
                                    <p><span v-for="director in currentMovie.director">[[ director ]],</span></p>
                                </div>
                                <div class="movie_modal_text_section">
                                    <p>출연</p>
                                    <p><span v-for="actor in currentMovie.actor">[[ actor ]],</span></p>
                                </div>
                                <div class="movie_modal_text_section">
                                    <p>줄거리</p>
                                    <p>[[currentMovie.description]]</p>
                                </div>
                            </div>
                        </div>
                        <div class="movie_modal_right">
                            <h4>평점</h4>
                            <div class="score_form_outer">
                                <div class="star_rate">
                                    <!--<span class="rating">-->
                                    <!--    <input type="radio" class="rating-input"-->
                                    <!--            id="rating-input-1-5" name="rating-input-1" value=10 v-model="rating_score">-->
                                    <!--    <label for="rating-input-1-5" class="rating-star" title="10">★</label>-->
                                        
                                    <!--    <input type="radio" class="rating-input"-->
                                    <!--            id="rating-input-1-4" name="rating-input-1" value=8 v-model="rating_score">-->
                                    <!--    <label for="rating-input-1-4" class="rating-star" title="8">★</label>-->
                                        
                                    <!--    <input type="radio" class="rating-input"-->
                                    <!--            id="rating-input-1-3" name="rating-input-1" value=6 v-model="rating_score">-->
                                    <!--    <label for="rating-input-1-3" class="rating-star" title="6">★</label>-->
                                        
                                    <!--    <input type="radio" class="rating-input"-->
                                    <!--            id="rating-input-1-2" name="rating-input-1" value=4 v-model="rating_score">-->
                                    <!--    <label for="rating-input-1-2" class="rating-star" title="4">★</label>-->
                                        
                                    <!--    <input type="radio" class="rating-input"-->
                                    <!--            id="rating-input-1-1" name="rating-input-1" value=2 v-model="rating_score">-->
                                    <!--    <label for="rating-input-1-1" class="rating-star" title="2">★</label>-->
                                    <!--</span>-->
                                    
                                    <span class="rating">
                                        <input type="radio" class="rating-input"
                                                id="rating-input-1-5" name="rating-input-1" value=10 v-model="rating_score">
                                        <label for="rating-input-1-5" class="rating-star" title="10" @mouseover="scoreHoverOver(10)" @mouseleave="scoreHoverLeave()">★</label>
                                        
                                        <input type="radio" class="rating-input"
                                                id="rating-input-1-4" name="rating-input-1" value=8 v-model="rating_score">
                                        <label for="rating-input-1-4" class="rating-star" title="8" @mouseover="scoreHoverOver(8)" @mouseleave="scoreHoverLeave()">★</label>
                                        
                                        <input type="radio" class="rating-input"
                                                id="rating-input-1-3" name="rating-input-1" value=6 v-model="rating_score">
                                        <label for="rating-input-1-3" class="rating-star" title="6" @mouseover="scoreHoverOver(6)" @mouseleave="scoreHoverLeave()">★</label>
                                        
                                        <input type="radio" class="rating-input"
                                                id="rating-input-1-2" name="rating-input-1" value=4 v-model="rating_score">
                                        <label for="rating-input-1-2" class="rating-star" title="4" @mouseover="scoreHoverOver(4)" @mouseleave="scoreHoverLeave()">★</label>
                                        
                                        <input type="radio" class="rating-input"
                                                id="rating-input-1-1" name="rating-input-1" value=2 v-model="rating_score">
                                        <label for="rating-input-1-1" class="rating-star" title="2" @mouseover="scoreHoverOver(2)" @mouseleave="scoreHoverLeave()">★</label>
                                    </span>
                                </div>
                                <div class="score_num">
                                    <span v-if="scoreHover">[[ ratingScoreTmp ]]점</span>
                                    <span v-else>[[ rating_score ]]점</span>
                                </div>
                                <input type="text" class="score_input" v-model="ratingScoreContent">
                                <button class="btn btn-sm btn-crimson score_btn" @click="createScoreReview()">등록</button>
                            </div>
                            
                            <div class="showReviews">
                                <div class="reviewContainer" v-for="review in currentScores">
                                    <div class="reviewStars">
                                        <div class="star-ratings-css">
                                            <div class="star-ratings-css-top" :style="{'width': `${review.score*10}%`}">
                                                <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                            <div class="star-ratings-css-bottom">
                                                <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                                        </div>
                                        [[ review.score ]]점
                                    </div>
                                    <div class="reviewComment">[[ review.comment ]] - [[ review.user.username | truncUsername ]]
                                        <span class="editdelbtn" v-if="review.user.id == {{user.id}}" @click="deleteScoreReview(review.id)">삭제</span>
                                    </div>
                            
                                </div>
                            </div>
    
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <footer>
            <h4>KCM의 흑백영화</h4>
            <p>SSAFY 1기 서울 1반 최종 프로젝트 (2019년 5월)</p>
            <p>강창모: dkssudckdah@gmail.com</p>
            <p>윤지원: jiwonjulietyoon@gmail.com</p>
        </footer>
        
    </div>


    
    <script>
        
        const arrRemove = (arr, val) => {
            return arr.filter(function(el) {
                return el != val;
            });
        };
        
        const arrRemoveByID = (arr, id) => {
            return arr.filter(function(el) {
                return el.id != id
            });
        }
        
        
        const app = new Vue({
            delimiters: ['[[', ']]'],
            el: '#wrap',
            data: {
                rating_score: 0,
                ratingScoreTmp: '',
                ratingScoreContent: '',
                scoreHover: false,
                allMovies: [],
                currentMovie: '',
                allGenres: [],
                selectedGenres: [],
                allGenresSelected: false,
                genreBtnVisible: false,
                suggNationOpt: 'all',
                allScores: [],
                currentScores: [],
                userWatchlist: [],
                currentMovieInWatch: false,
                showMode: 'main', // main, sugg, watch
            },
            methods: {
                scoreHoverOver(num) {
                    this.scoreHover = true
                    this.ratingScoreTmp = num
                },
                scoreHoverLeave() {
                    this.scoreHover = false
                },
                genreSelectToggle(genre) {
                    if (genre.selected) {
                        genre.selected = false;
                        this.selectedGenres = arrRemove(this.selectedGenres, genre.genreNm);
                    }
                    else {
                        genre.selected = true;
                        this.selectedGenres.push(genre.genreNm);
                    }
                },
                async getAllMovies() {
                    const tmp = await axios.get('https://final-prj-whitejcme.c9users.io/movies/get/')
                    this.allMovies = tmp.data
                    this.userWatchlist = this.allMovies.filter((movie) => {
                        return movie.watchUsers.some((user) => {
                            return user === "{{user}}"
                        });
                    });
                },
                getAllGenres() {
                    axios.get('https://final-prj-whitejcme.c9users.io/movies/get/genres/')
                        .then((res) => {
                            this.allGenres = res.data
                        })
                },
                async setCurrentMovie(movie) {
                    this.currentMovie = movie;
                    let res_score = await axios.get(`https://final-prj-whitejcme.c9users.io/movies/${movie.id}/scores/`)
                    this.currentScores = res_score.data;
                    
                    if (movie.watchUsers.includes("{{user}}")) {
                        this.currentMovieInWatch = true
                    }

                },
                getAllScores() {
                    axios.get('https://final-prj-whitejcme.c9users.io/movies/scores/')
                        .then((res) => {
                            this.allScores = res.data
                        });
                },
                createScoreReview() {
                    axios.defaults.xsrfCookieName = 'csrftoken'
                    axios.defaults.xsrfHeaderName = "X-CSRFTOKEN"
                    axios.post(`https://final-prj-whitejcme.c9users.io/movies/${this.currentMovie.id}/scores/`, {
                        comment: this.ratingScoreContent,
                        score: this.rating_score,
                    }).then((res) => {
                        let newScore = {
                            comment: this.ratingScoreContent,
                            score: this.rating_score,
                            movie: this.currentMovie.id,
                            user: {
                                id: Number("{{user.id}}"),
                                username: "{{userName}}",
                            }
                        }
                        this.currentScores.push(newScore);
                        this.rating_score = 0;
                        this.ratingScoreContent = '';
                    });
                },
                deleteScoreReview(id) {
                    axios.defaults.xsrfCookieName = 'csrftoken'
                    axios.defaults.xsrfHeaderName = "X-CSRFTOKEN"
                    axios.delete(`https://final-prj-whitejcme.c9users.io/movies/scores/${id}/`)
                        .then((res) => {
                            this.currentScores = arrRemoveByID(this.currentScores, id);
                        });
                },
                currentMovieInWatchlist() {
                    if (this.userWatchlist.includes(this.currentMovie)) {
                        return true
                    }
                    else {
                        return false
                    }
                },
                async addToWatch(movieID) {
                    axios.get(`https://final-prj-whitejcme.c9users.io/movies/get/${movieID}/watches/`);
                    // this.currentMovieInWatch = true;
                    this.userWatchlist.push(this.currentMovie);
                    this.currentMovieInWatchlist();
                },
                async removeFromWatch(movieID) {
                    axios.get(`https://final-prj-whitejcme.c9users.io/movies/get/${movieID}/watches/`);
                    // this.currentMovieInWatch = false;
                    this.userWatchlist = arrRemoveByID(this.userWatchlist, movieID);
                    this.currentMovieInWatchlist();
                },
                
            },
            watch: {
                allGenresSelected: function(val) {
                    if (val) {
                        this.selectedGenres = this.allGenres.map(g => g.genreNm);
                        this.allGenres.forEach(g => {
                            g.selected = true;
                        });
                    }
                    else {
                        this.selectedGenres = [];
                        this.allGenres.forEach(g => {
                            g.selected = false;
                        });
                    }
                }
            },
            filters: {
                getYear(value) {
                    if (!value) {
                        return ''
                    }
                    return value.slice(0, 4)
                },
                truncUsername(name) {
                    return `${name.slice(0, 2)}***`
                }
            },
            computed: {
                suggestedMovies: function() {
                    let filteredByGenreMovies = _.orderBy(this.allMovies, 'score', 'desc').filter((movie) => {
                        return movie.genre.some(g => this.selectedGenres.includes(g));
                    });
                    
                    if (this.suggNationOpt == 'all') {
                        return filteredByGenreMovies
                    }
                    else if (this.suggNationOpt == "kor") {
                        return filteredByGenreMovies.filter((movie) => {
                            return movie.nation.some(g => g === "한국");
                        });
                    }
                    else {
                        return filteredByGenreMovies.filter((movie) => {
                            return movie.nation.every(g => g !== "한국");
                        });
                    }
                },
                watchlistMovies: function() {
                    let filteredByGenreMovies = this.userWatchlist.filter((movie) => {
                        return movie.genre.some(g => this.selectedGenres.includes(g));
                    });
                    
                    if (this.suggNationOpt == 'all') {
                        return filteredByGenreMovies
                    }
                    else if (this.suggNationOpt == "kor") {
                        return filteredByGenreMovies.filter((movie) => {
                            return movie.nation.some(g => g === "한국");
                        });
                    }
                    else {
                        return filteredByGenreMovies.filter((movie) => {
                            return movie.nation.every(g => g !== "한국");
                        });
                    }
                },
            },
            created: function () {
                this.getAllMovies();
                this.getAllGenres();
                this.getAllScores();
            }
        });
        
        var swiper = new Swiper('.swiper-container', {
            effect: 'coverflow',
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            coverflowEffect: {
                rotate: 50,
                stretch: 0,
                depth: 100,
                modifier: 1,
                slideShadows: true,
            },
        });
        
        var swiper2 = new Swiper('.swiper-container2', {
            effect: 'coverflow',
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            coverflowEffect: {
                rotate: 50,
                stretch: 0,
                depth: 100,
                modifier: 1,
                slideShadows: true,
            },
        });
        

        
    </script>
</body>

</html>